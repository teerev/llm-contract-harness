{
  "id": "WO-11",
  "title": "WO-11: Render helpers v1 (fit segments to canvas)",
  "intent": "Create deterministic helpers that map world-coordinate line segments to integer pixel segments that fit within the output image.",
  "allowed_files": [
    "lsysviz/render.py"
  ],
  "forbidden": [
    "Do not modify files outside allowed_files.",
    "Do not add new dependencies.",
    "Do not implement the full render_png_bytes pipeline in this step (defer to WO-12).",
    "Do not implement CLI changes in this step.",
    "Keep lsysviz/render.py small (aim for <= 200 lines)."
  ],
  "acceptance_commands": [
    "bash scripts/verify.sh",
    "python -c \"from lsysviz.render import fit_segments_to_canvas; segs=[((0.0,0.0),(0.0,1.0)),((0.0,1.0),(1.0,1.0))]; out=fit_segments_to_canvas(segs,10,10); assert all(isinstance(p[0][0],int) for p in out)\""
  ],
  "context_files": [],
  "notes": "Type: additive-feature. Contracts (frozen): Define and freeze fit_segments_to_canvas(segments,width,height,pad=0)->list[segment] where segments are ((x0,y0),(x1,y1)) float tuples in world coordinates and the output is integer pixel endpoints. The mapping must be deterministic and based on the segments' bounding box: scale uniformly to fit within [pad, width-1-pad] x [pad, height-1-pad]. Coordinate convention is frozen: world +Y is up; image Y is down, so the mapping must flip Y deterministically. Compositionality: isolates coordinate mapping so the end-to-end renderer can be small and stable."
}

