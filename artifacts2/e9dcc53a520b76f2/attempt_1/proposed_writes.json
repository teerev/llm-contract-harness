{
  "summary": "Added deterministic unit tests for mazegen.generate and updated verification script to run pytest after compileall.",
  "writes": [
    {
      "base_sha256": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
      "content": "from __future__ import annotations\n\nfrom collections import deque\n\nimport pytest\n\nfrom mazegen.generate import generate\nfrom mazegen.types import Maze, Position\n\n\ndef _adjacency(maze: Maze) -> dict[Position, set[Position]]:\n    adj: dict[Position, set[Position]] = {\n        Position(r, c): set() for r in range(maze.height) for c in range(maze.width)\n    }\n    for a, b in maze.passages:\n        adj[a].add(b)\n        adj[b].add(a)\n    return adj\n\n\ndef _reachable_from_start(maze: Maze) -> set[Position]:\n    adj = _adjacency(maze)\n    seen: set[Position] = set()\n    q: deque[Position] = deque([maze.start])\n    seen.add(maze.start)\n    while q:\n        p = q.popleft()\n        for n in adj[p]:\n            if n in seen:\n                continue\n            seen.add(n)\n            q.append(n)\n    return seen\n\n\ndef test_generate_returns_maze_with_expected_metadata() -> None:\n    width = 4\n    height = 3\n    seed = 123\n\n    maze = generate(width, height, seed)\n\n    assert isinstance(maze, Maze)\n    assert maze.width == width\n    assert maze.height == height\n    assert maze.seed == seed\n    assert maze.start == Position(0, 0)\n    assert maze.end == Position(height - 1, width - 1)\n\n\ndef test_generate_is_deterministic_for_same_seed() -> None:\n    width = 10\n    height = 7\n    seed = 999\n\n    m1 = generate(width, height, seed)\n    m2 = generate(width, height, seed)\n\n    assert m1.passages == m2.passages\n\n\ndef test_perfect_maze_has_w_times_h_minus_1_passages() -> None:\n    width = 8\n    height = 6\n    seed = 42\n\n    maze = generate(width, height, seed)\n\n    assert len(maze.passages) == width * height - 1\n\n\ndef test_all_cells_reachable_from_start() -> None:\n    width = 9\n    height = 5\n    seed = 2024\n\n    maze = generate(width, height, seed)\n    reachable = _reachable_from_start(maze)\n\n    assert len(reachable) == width * height\n    assert maze.end in reachable\n\n\ndef test_different_seeds_produce_different_mazes() -> None:\n    width = 12\n    height = 8\n\n    m1 = generate(width, height, seed=1)\n    m2 = generate(width, height, seed=2)\n\n    assert m1.passages != m2.passages\n",
      "path": "tests/test_generate.py"
    },
    {
      "base_sha256": "87945f9eaa188bf4f4412f9522bb7f40e85e870de32d966c7aee07c921ac5887",
      "content": "#!/usr/bin/env bash\nset -euo pipefail\npython -m compileall -q .\npython -m pytest -q\n",
      "path": "scripts/verify.sh"
    }
  ]
}
