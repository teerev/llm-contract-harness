{
  "summary": "Added worldsim/render_html.py implementing render_html(states, output_path) to generate a standalone HTML file with embedded JSON frame data and a canvas-based animation with pause-on-click and step counter. No changes to worldsim/types.py.",
  "writes": [
    {
      "base_sha256": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
      "content": "from __future__ import annotations\n\nimport json\nfrom typing import List\n\nfrom .types import WorldState\n\n\ndef render_html(states: List[WorldState], output_path: str) -> None:\n    \"\"\"Write a self-contained HTML file that replays simulation frames on a canvas.\n\n    The output HTML is standalone (no server required) and embeds all frame data\n    directly into a <script> block.\n    \"\"\"\n\n    frames = []\n    for s in states:\n        agents = []\n        for pos, agent in s.agents:\n            agents.append([pos.row, pos.col, agent.energy, agent.age, agent.direction])\n        frames.append(\n            {\n                \"step\": int(s.step_number),\n                \"width\": int(s.width),\n                \"height\": int(s.height),\n                \"agents\": agents,\n            }\n        )\n\n    frames_json = json.dumps(frames, separators=(\",\", \":\"), ensure_ascii=False)\n\n    html = (\n        \"<!DOCTYPE html>\\n\"\n        \"<html>\\n\"\n        \"<head>\\n\"\n        \"  <meta charset='utf-8'/>\\n\"\n        \"  <meta name='viewport' content='width=device-width, initial-scale=1'/>\\n\"\n        \"  <title>worldsim</title>\\n\"\n        \"  <style>\\n\"\n        \"    body {\\n\"\n        \"      margin: 0;\\n\"\n        \"      background: #1a1a2e;\\n\"\n        \"      color: white;\\n\"\n        \"      font-family: monospace;\\n\"\n        \"      display: flex;\\n\"\n        \"      flex-direction: column;\\n\"\n        \"      align-items: center;\\n\"\n        \"      justify-content: flex-start;\\n\"\n        \"      min-height: 100vh;\\n\"\n        \"      padding-top: 16px;\\n\"\n        \"      box-sizing: border-box;\\n\"\n        \"    }\\n\"\n        \"    canvas {\\n\"\n        \"      display: block;\\n\"\n        \"      border: 1px solid rgba(255,255,255,0.15);\\n\"\n        \"      background: #000;\\n\"\n        \"    }\\n\"\n        \"    #info {\\n\"\n        \"      margin: 10px 0 0 0;\\n\"\n        \"      opacity: 0.9;\\n\"\n        \"    }\\n\"\n        \"  </style>\\n\"\n        \"  <script>\\n\"\n        f\"    const FRAMES = {frames_json};\\n\"\n        \"\\n\"\n        \"    let canvas;\\n\"\n        \"    let ctx;\\n\"\n        \"    let info;\\n\"\n        \"    let frameIndex = 0;\\n\"\n        \"    let paused = false;\\n\"\n        \"\\n\"\n        \"    function draw(i) {\\n\"\n        \"      if (!FRAMES || FRAMES.length === 0) {\\n\"\n        \"        ctx.fillStyle = '#000';\\n\"\n        \"        ctx.fillRect(0, 0, canvas.width, canvas.height);\\n\"\n        \"        info.textContent = 'No frames to display.';\\n\"\n        \"        return;\\n\"\n        \"      }\\n\"\n        \"\\n\"\n        \"      const frame = FRAMES[i];\\n\"\n        \"      const cellW = canvas.width / frame.width;\\n\"\n        \"      const cellH = canvas.height / frame.height;\\n\"\n        \"\\n\"\n        \"      ctx.fillStyle = '#000';\\n\"\n        \"      ctx.fillRect(0, 0, canvas.width, canvas.height);\\n\"\n        \"\\n\"\n        \"      const agents = frame.agents;\\n\"\n        \"      for (let k = 0; k < agents.length; k++) {\\n\"\n        \"        const a = agents[k];\\n\"\n        \"        const row = a[0];\\n\"\n        \"        const col = a[1];\\n\"\n        \"        const energy = a[2];\\n\"\n        \"\\n\"\n        \"        if (energy > 10) ctx.fillStyle = '#00ff88';\\n\"\n        \"        else if (energy >= 5) ctx.fillStyle = '#ffcc00';\\n\"\n        \"        else ctx.fillStyle = '#ff4444';\\n\"\n        \"\\n\"\n        \"        const x = col * cellW;\\n\"\n        \"        const y = row * cellH;\\n\"\n        \"        ctx.fillRect(x, y, Math.max(0, cellW - 1), Math.max(0, cellH - 1));\\n\"\n        \"      }\\n\"\n        \"\\n\"\n        \"      info.textContent = `step: ${frame.step}  frame: ${i + 1}/${FRAMES.length}  agents: ${frame.agents.length}  (${paused ? 'paused' : 'playing'})`;\\n\"\n        \"    }\\n\"\n        \"\\n\"\n        \"    function tick() {\\n\"\n        \"      if (paused) return;\\n\"\n        \"      if (!FRAMES || FRAMES.length === 0) return;\\n\"\n        \"      frameIndex = (frameIndex + 1) % FRAMES.length;\\n\"\n        \"      draw(frameIndex);\\n\"\n        \"    }\\n\"\n        \"\\n\"\n        \"    window.addEventListener('DOMContentLoaded', () => {\\n\"\n        \"      canvas = document.getElementById('grid');\\n\"\n        \"      ctx = canvas.getContext('2d');\\n\"\n        \"      info = document.getElementById('info');\\n\"\n        \"\\n\"\n        \"      canvas.addEventListener('click', () => {\\n\"\n        \"        paused = !paused;\\n\"\n        \"        draw(frameIndex);\\n\"\n        \"      });\\n\"\n        \"\\n\"\n        \"      draw(frameIndex);\\n\"\n        \"      setInterval(tick, 200);\\n\"\n        \"    });\\n\"\n        \"  </script>\\n\"\n        \"</head>\\n\"\n        \"<body>\\n\"\n        \"  <canvas id='grid' width='800' height='600'></canvas>\\n\"\n        \"  <p id='info'></p>\\n\"\n        \"</body>\\n\"\n        \"</html>\\n\"\n    )\n\n    with open(output_path, \"w\", encoding=\"utf-8\") as f:\n        f.write(html)\n",
      "path": "worldsim/render_html.py"
    }
  ]
}
