.......F.F                                                               [100%]
=================================== FAILURES ===================================
_ test_population_invariant_population_before_plus_births_minus_deaths_equals_after_each_step _

    def test_population_invariant_population_before_plus_births_minus_deaths_equals_after_each_step():
        config = SimConfig(width=14, height=9, seed=31415, initial_density=0.5)
        world = create_world(config)
    
        for _ in range(20):
            before = world.get_state()
            pop_before = len(before.agents)
            res = world.step()
            pop_after = len(res.world.agents)
    
>           assert pop_before + res.births - res.deaths == pop_after
E           assert ((64 + 0) - 0) == 62
E            +  where 0 = StepResult(world=WorldState(width=14, height=9, step_number=1, seed=31415, agents=((Position(row=0, col=0), Agent(ener...=1, direction=3)), (Position(row=8, col=13), Agent(energy=11, age=1, direction=1)))), births=0, deaths=0, movements=52).births
E            +  and   0 = StepResult(world=WorldState(width=14, height=9, step_number=1, seed=31415, agents=((Position(row=0, col=0), Agent(ener...=1, direction=3)), (Position(row=8, col=13), Agent(energy=11, age=1, direction=1)))), births=0, deaths=0, movements=52).deaths

tests/test_simulation.py:102: AssertionError
___ test_age_monotonicity_ages_only_increase_for_survivors_excluding_births ____

    def test_age_monotonicity_ages_only_increase_for_survivors_excluding_births():
        """Ages should never decrease for agents that survive from one step to the next.
    
        Because agents move and births can place a new agent (age=0) into a position
        that was previously occupied, we cannot compare by Position. Instead, we
        compare the multiset of ages after removing the expected number of births.
    
        In default_ruleset, every surviving pre-step agent is aged by +1 before any
        reproduction/death filtering, and births always have age=0.
        """
    
        config = SimConfig(width=14, height=9, seed=31415, initial_density=0.5)
        world = create_world(config)
    
        for _ in range(10):
            before = world.get_state()
            before_ages_plus1 = sorted(agent.age + 1 for _pos, agent in before.agents)
    
            res = world.step()
            after_ages = sorted(agent.age for _pos, agent in res.world.agents)
    
            # Remove births (age 0) from the after list; remaining are survivors.
            zeros = sum(1 for a in after_ages if a == 0)
            assert zeros >= res.births
            after_survivor_ages = after_ages[res.births:]
    
            # Survivors are exactly the pre-step agents that did not die.
            expected_survivors = len(before.agents) - res.deaths
>           assert len(after_survivor_ages) == expected_survivors
E           assert 62 == 64
E            +  where 62 = len([1, 1, 1, 1, 1, 1, ...])

tests/test_simulation.py:143: AssertionError
=========================== short test summary info ============================
FAILED tests/test_simulation.py::test_population_invariant_population_before_plus_births_minus_deaths_equals_after_each_step
FAILED tests/test_simulation.py::test_age_monotonicity_ages_only_increase_for_survivors_excluding_births
2 failed, 8 passed in 0.46s
