.......F.F                                                               [100%]
=================================== FAILURES ===================================
_ test_population_invariant_population_before_plus_births_minus_deaths_equals_after_each_step _

    def test_population_invariant_population_before_plus_births_minus_deaths_equals_after_each_step():
        config = SimConfig(width=16, height=10, seed=77, initial_density=0.45)
        world = create_world(config)
    
        for _ in range(10):
            before = world.get_state()
            pop_before = len(before.agents)
            res = world.step()
            pop_after = len(res.world.agents)
    
>           assert pop_before + res.births - res.deaths == pop_after
E           assert ((73 + 0) - 0) == 72
E            +  where 0 = StepResult(world=WorldState(width=16, height=10, step_number=1, seed=77, agents=((Position(row=0, col=1), Agent(energy...=1, direction=3)), (Position(row=9, col=15), Agent(energy=11, age=1, direction=2)))), births=0, deaths=0, movements=65).births
E            +  and   0 = StepResult(world=WorldState(width=16, height=10, step_number=1, seed=77, agents=((Position(row=0, col=1), Agent(energy...=1, direction=3)), (Position(row=9, col=15), Agent(energy=11, age=1, direction=2)))), births=0, deaths=0, movements=65).deaths

tests/test_simulation.py:99: AssertionError
__ test_age_monotonicity_agent_ages_only_increase_across_steps_for_survivors ___

    def test_age_monotonicity_agent_ages_only_increase_across_steps_for_survivors():
        config = SimConfig(width=20, height=10, seed=888, initial_density=0.5)
        world = create_world(config)
    
        for _ in range(10):
            before = world.get_state()
            before_agents = _agents_dict(before)
            res = world.step()
            after_agents = _agents_dict(res.world)
    
            # For any position that remains occupied, the agent there must have aged by exactly 1.
            # (Movement can change positions; this checks monotonicity for survivors that stayed in place.)
            for pos, before_agent in before_agents.items():
                if pos in after_agents:
>                   assert after_agents[pos].age == before_agent.age + 1
E                   assert 0 == (4 + 1)
E                    +  where 0 = Agent(energy=8, age=0, direction=0).age
E                    +  and   4 = Agent(energy=14, age=4, direction=2).age

tests/test_simulation.py:126: AssertionError
=========================== short test summary info ============================
FAILED tests/test_simulation.py::test_population_invariant_population_before_plus_births_minus_deaths_equals_after_each_step
FAILED tests/test_simulation.py::test_age_monotonicity_agent_ages_only_increase_across_steps_for_survivors
2 failed, 8 passed in 0.46s
