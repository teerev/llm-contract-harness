.......F.F                                                               [100%]
=================================== FAILURES ===================================
_ test_population_invariant_population_before_plus_births_minus_deaths_equals_after _

    def test_population_invariant_population_before_plus_births_minus_deaths_equals_after():
        # In default_ruleset phase 1, an agent only moves if the target is empty in the *new* map.
        # That prevents overwrites/collisions, so population changes only via births and deaths.
        config = SimConfig(width=16, height=10, seed=77, initial_density=0.45)
        world = create_world(config)
    
        for _ in range(10):
            before = world.get_state()
            pop_before = len(before.agents)
            res = world.step()
            pop_after = len(res.world.agents)
    
>           assert pop_before + res.births - res.deaths == pop_after
E           assert ((73 + 0) - 0) == 72
E            +  where 0 = StepResult(world=WorldState(width=16, height=10, step_number=1, seed=77, agents=((Position(row=0, col=1), Agent(energy...=1, direction=3)), (Position(row=9, col=15), Agent(energy=11, age=1, direction=2)))), births=0, deaths=0, movements=65).births
E            +  and   0 = StepResult(world=WorldState(width=16, height=10, step_number=1, seed=77, agents=((Position(row=0, col=1), Agent(energy...=1, direction=3)), (Position(row=9, col=15), Agent(energy=11, age=1, direction=2)))), births=0, deaths=0, movements=65).deaths

tests/test_simulation.py:99: AssertionError
____________ test_age_monotonicity_ages_only_increase_for_survivors ____________

    def test_age_monotonicity_ages_only_increase_for_survivors():
        config = SimConfig(width=14, height=9, seed=31415, initial_density=0.5)
        world = create_world(config)
    
        for _ in range(10):
            before = world.get_state()
            before_agents = _agents_dict(before)
            res = world.step()
            after_agents = _agents_dict(res.world)
    
            # For any agent that remains at the same position across the step,
            # its age must increase by exactly 1 (ruleset increments age each tick).
            for pos, after_agent in after_agents.items():
                if pos in before_agents:
>                   assert after_agent.age == before_agents[pos].age + 1
E                   assert 0 == (4 + 1)
E                    +  where 0 = Agent(energy=8, age=0, direction=2).age
E                    +  and   4 = Agent(energy=14, age=4, direction=3).age

tests/test_simulation.py:127: AssertionError
=========================== short test summary info ============================
FAILED tests/test_simulation.py::test_population_invariant_population_before_plus_births_minus_deaths_equals_after
FAILED tests/test_simulation.py::test_age_monotonicity_ages_only_increase_for_survivors
2 failed, 8 passed in 0.46s
