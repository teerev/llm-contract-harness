{
  "summary": "Added a comprehensive README.md for the worldsim package, documenting purpose, CLI usage and flags, examples (headless/ASCII/HTML), Python API overview, default ruleset behavior, determinism, checkpointing/resume, and HTML viewer notes.",
  "writes": [
    {
      "base_sha256": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
      "content": "# worldsim\n\n`worldsim` is a small, deterministic, grid-based \u201clife\u201d simulation. Agents live on a toroidal (wrapping) 2D grid, move, gain/spend energy, reproduce into adjacent empty cells, and die from low energy or old age. The package includes a CLI for running simulations, CSV stats output, JSON checkpointing, and optional ASCII or self-contained HTML rendering.\n\n## Quick start (CLI)\n\nRun a 20\u00d710 world for 50 steps and print CSV stats:\n\n```bash\nworldsim --width 20 --height 10 --seed 1 --steps 50\n```\n\n## CLI reference\n\nThe CLI entrypoint is `worldsim` (module: `worldsim.cli`).\n\n### Required flags\n\n- `--width INT` \u2014 World width in cells.\n- `--height INT` \u2014 World height in cells.\n- `--seed INT` \u2014 Random seed.\n- `--steps INT` \u2014 Number of steps to simulate.\n\n### Optional simulation parameters\n\n- `--density FLOAT` \u2014 Initial agent density (0.0\u20131.0). Default: `0.3`\n- `--initial-energy INT` \u2014 Initial energy for newly created agents. Default: `10`\n- `--energy-gain INT` \u2014 Energy gained per step. Default: `2`\n- `--move-cost INT` \u2014 Energy cost per move/step. Default: `1`\n- `--reproduction-threshold INT` \u2014 Energy threshold to reproduce. Default: `15`\n- `--reproduction-cost INT` \u2014 Energy cost paid by parent and given to child. Default: `8`\n- `--max-age INT` \u2014 Maximum age before death. Default: `50`\n\n### Output / rendering\n\n- `--render {none,ascii,html}` \u2014 Render mode. Default: `none`\n- `--html-output PATH` \u2014 Output path for HTML render. Default: `simulation.html`\n\n### Checkpointing\n\n- `--checkpoint-in PATH` \u2014 Load a JSON checkpoint from this path to start simulation.\n- `--checkpoint-out PATH` \u2014 Write a JSON checkpoint to this path after simulation.\n\n### Other\n\n- `--version` \u2014 Print version information and exit.\n\n## Examples\n\n### 1) Headless run (CSV stats)\n\n```bash\nworldsim --width 40 --height 20 --seed 123 --steps 200\n```\n\nOutput is CSV to stdout with header:\n\n```\nstep_number,population,births,deaths,avg_energy,density\n...\n```\n\n### 2) ASCII render (prints a grid each step)\n\n```bash\nworldsim --width 20 --height 10 --seed 7 --steps 25 --render ascii\n```\n\nASCII legend (from `worldsim.render_ascii.render_ascii`):\n\n- `.` empty\n- `@` agent with energy > 5\n- `o` agent with energy 1\u20135\n- `x` agent with energy <= 0 (note: the default rules remove dead agents, so `x` is typically not seen)\n\nAfter the simulation, CSV stats are printed.\n\n### 3) HTML viewer generation (self-contained file)\n\n```bash\nworldsim --width 60 --height 40 --seed 42 --steps 300 --render html --html-output out/simulation.html\n```\n\nThis writes the HTML file path to stdout (and does not print CSV stats in HTML mode). Open the generated file directly in a browser.\n\n## Python API\n\nCore types live in `worldsim.types`:\n\n- `SimConfig`\n- `WorldState`\n- `StepResult`\n- `TickMetrics`\n\n### Create a world\n\n```python\nfrom worldsim.types import SimConfig\nfrom worldsim.world import create_world\n\nconfig = SimConfig(width=20, height=10, seed=1, initial_density=0.3, max_steps=100)\nworld = create_world(config)\n```\n\n`create_world(config)` initializes agents by scanning the grid in row-major order using `random.Random(config.seed)`.\n\n### Step the simulation\n\n```python\nresult = world.step()          # StepResult\nstate = result.world           # WorldState snapshot\nprint(state.step_number)\n```\n\n- `World.step()` advances by exactly one tick and returns a `StepResult(world, births, deaths, movements)`.\n- `World.get_state()` returns an immutable `WorldState` snapshot with agents sorted by position.\n\n### Collect stats\n\n```python\nfrom worldsim.stats import StatsCollector\n\nstats = StatsCollector()\nfor _ in range(100):\n    stats.record(world.step())\n\ncsv_text = stats.to_csv()\nprint(csv_text)\n```\n\n`StatsCollector.record(step_result)` computes:\n\n- population\n- births, deaths (from the step result)\n- average energy\n- density = population / (width * height)\n\n### Render ASCII\n\n```python\nfrom worldsim.render_ascii import render_ascii\n\nprint(render_ascii(world.get_state()))\n```\n\n### Render HTML\n\n```python\nfrom worldsim.render_html import render_html\n\nstates = [world.get_state()]\nfor _ in range(200):\n    states.append(world.step().world)\n\nrender_html(states, \"simulation.html\")\n```\n\n`render_html(states, output_path)` writes a self-contained HTML file that replays frames on a canvas.\n\n### Checkpointing\n\n```python\nfrom worldsim.checkpoint import save_checkpoint, load_checkpoint\n\nsave_checkpoint(world.get_state(), \"checkpoint.json\")\nstate = load_checkpoint(\"checkpoint.json\")\n```\n\nTo resume, construct a `World` with the loaded state:\n\n```python\nfrom worldsim.world import World\n\nworld2 = World(config=config, state=state)\n```\n\n## Default ruleset\n\nThe default rules are implemented in `worldsim.rules.default_ruleset` and applied each step in phases:\n\n1. **Age**: every agent\u2019s `age` increments by 1.\n2. **Move**: agents move via `worldsim.movement.move_agents` (movement is part of the simulation step).\n3. **Energy update**: `energy += config.energy_gain - config.move_cost`.\n4. **Reproduce**: if an agent\u2019s energy is `>= reproduction_threshold`, it may place a child into an empty N/E/S/W adjacent cell (with toroidal wrapping). The child gets `energy = reproduction_cost`, `age = 0`, and a random direction. The parent pays `reproduction_cost` energy.\n5. **Death**: agents with `energy <= 0` or `age > max_age` are removed.\n\n## Determinism\n\nThe simulation is designed to be deterministic given the same:\n\n- `SimConfig` (notably `seed`, dimensions, and rule parameters)\n- starting `WorldState` (including `step_number`)\n\nImplementation details that support determinism:\n\n- `World.step()` derives a per-step RNG from `config.seed` and the current `step_number`.\n- `WorldState.agents` is stored/snapshotted sorted by `Position`.\n- Checkpoints re-sort agents by position on load.\n\nIf you resume from a checkpoint and continue stepping with the same `SimConfig`, you should get the same subsequent evolution as if you had never stopped.\n\n## Checkpoint / resume notes\n\n- Checkpoints are **JSON** (no pickle), written with sorted keys and 2-space indentation.\n- The checkpoint stores: `width`, `height`, `step_number`, `seed`, and all agents (position + energy/age/direction).\n- CLI behavior:\n  - `--checkpoint-in` loads a state and starts from it.\n  - `--checkpoint-out` writes the final state after the run.\n\nNote: the CLI still requires `--width/--height/--seed/--steps` even when using `--checkpoint-in`; the loaded checkpoint provides the world state, while the CLI config controls rule parameters and how many additional steps to run.\n\n## HTML viewer notes\n\n- `--render html` collects every frame (initial state plus each step) and writes a single HTML file.\n- The HTML is self-contained and can be opened directly (no server required).\n- The viewer draws agents as colored rectangles on a canvas and advances frames on a timer; clicking the canvas toggles pause.\n",
      "path": "README.md"
    }
  ]
}
