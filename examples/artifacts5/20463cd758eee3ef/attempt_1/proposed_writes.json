{
  "summary": "Updated worldsim/cli.py to add full simulation CLI arguments and wire them through checkpoint loading/saving, world creation/stepping, stats collection, and ASCII/HTML rendering modes while preserving --version behavior.",
  "writes": [
    {
      "base_sha256": "e58bb14ecefa38219c86bdb3c626e2fd0beaea345176a729e9d3de1a2415d14b",
      "content": "from __future__ import annotations\n\nimport argparse\n\nfrom . import __version__\nfrom .checkpoint import load_checkpoint, save_checkpoint\nfrom .render_ascii import render_ascii\nfrom .render_html import render_html\nfrom .stats import StatsCollector\nfrom .types import SimConfig\nfrom .world import World, create_world\n\n\ndef build_parser() -> argparse.ArgumentParser:\n    parser = argparse.ArgumentParser(prog=\"worldsim\")\n    parser.add_argument(\n        \"--version\",\n        action=\"store_true\",\n        help=\"Print version information and exit.\",\n    )\n\n    # Required\n    parser.add_argument(\"--width\", type=int, required=True, help=\"World width in cells.\")\n    parser.add_argument(\"--height\", type=int, required=True, help=\"World height in cells.\")\n    parser.add_argument(\"--seed\", type=int, required=True, help=\"Random seed.\")\n    parser.add_argument(\"--steps\", type=int, required=True, help=\"Number of steps to simulate.\")\n\n    # Optional simulation parameters\n    parser.add_argument(\n        \"--density\",\n        type=float,\n        default=0.3,\n        help=\"Initial agent density (0.0-1.0). Default: 0.3\",\n    )\n    parser.add_argument(\n        \"--initial-energy\",\n        type=int,\n        default=10,\n        help=\"Initial energy for newly created agents. Default: 10\",\n    )\n    parser.add_argument(\n        \"--energy-gain\",\n        type=int,\n        default=2,\n        help=\"Energy gained per step. Default: 2\",\n    )\n    parser.add_argument(\n        \"--move-cost\",\n        type=int,\n        default=1,\n        help=\"Energy cost per move/step. Default: 1\",\n    )\n    parser.add_argument(\n        \"--reproduction-threshold\",\n        type=int,\n        default=15,\n        help=\"Energy threshold to reproduce. Default: 15\",\n    )\n    parser.add_argument(\n        \"--reproduction-cost\",\n        type=int,\n        default=8,\n        help=\"Energy cost paid by parent and given to child. Default: 8\",\n    )\n    parser.add_argument(\n        \"--max-age\",\n        type=int,\n        default=50,\n        help=\"Maximum age before death. Default: 50\",\n    )\n\n    # Output / rendering\n    parser.add_argument(\n        \"--render\",\n        choices=[\"none\", \"ascii\", \"html\"],\n        default=\"none\",\n        help=\"Render mode: none, ascii, or html. Default: none\",\n    )\n    parser.add_argument(\n        \"--html-output\",\n        type=str,\n        default=\"simulation.html\",\n        help=\"Output path for HTML render. Default: simulation.html\",\n    )\n\n    # Checkpointing\n    parser.add_argument(\n        \"--checkpoint-out\",\n        type=str,\n        default=None,\n        help=\"Write a JSON checkpoint to this path after simulation.\",\n    )\n    parser.add_argument(\n        \"--checkpoint-in\",\n        type=str,\n        default=None,\n        help=\"Load a JSON checkpoint from this path to start simulation.\",\n    )\n\n    return parser\n\n\ndef main(argv: list[str] | None = None) -> int:\n    parser = build_parser()\n    args = parser.parse_args(argv)\n\n    if args.version:\n        print(__version__)\n        return 0\n\n    config = SimConfig(\n        width=int(args.width),\n        height=int(args.height),\n        seed=int(args.seed),\n        initial_density=float(args.density),\n        max_steps=int(args.steps),\n        initial_energy=int(args.initial_energy),\n        energy_gain=int(args.energy_gain),\n        move_cost=int(args.move_cost),\n        reproduction_threshold=int(args.reproduction_threshold),\n        reproduction_cost=int(args.reproduction_cost),\n        max_age=int(args.max_age),\n    )\n\n    if args.checkpoint_in:\n        loaded_state = load_checkpoint(args.checkpoint_in)\n        world = World(config=config, state=loaded_state)\n    else:\n        world = create_world(config)\n\n    stats = StatsCollector()\n\n    states = None\n    if args.render == \"html\":\n        states = [world.get_state()]\n\n    for _ in range(int(args.steps)):\n        step_result = world.step()\n        stats.record(step_result)\n\n        if args.render == \"ascii\":\n            print(render_ascii(step_result.world))\n            print()\n        elif args.render == \"html\":\n            assert states is not None\n            states.append(step_result.world)\n\n    if args.render in (\"none\", \"ascii\"):\n        print(stats.to_csv())\n    elif args.render == \"html\":\n        assert states is not None\n        render_html(states, args.html_output)\n        print(args.html_output)\n\n    if args.checkpoint_out:\n        save_checkpoint(world.get_state(), args.checkpoint_out)\n\n    return 0\n",
      "path": "worldsim/cli.py"
    }
  ]
}
