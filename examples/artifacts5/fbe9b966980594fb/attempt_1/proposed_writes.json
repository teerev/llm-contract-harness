{
  "summary": "Added worldsim/render_html.py implementing render_html(states, output_path) to generate a standalone HTML canvas replay with embedded JSON frames, animation loop, and click-to-pause behavior. No changes to worldsim/types.py.",
  "writes": [
    {
      "base_sha256": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
      "content": "from __future__ import annotations\n\nimport json\nfrom pathlib import Path\nfrom typing import List\n\nfrom .types import WorldState\n\n\ndef render_html(states: List[WorldState], output_path: str) -> None:\n    \"\"\"Write a self-contained HTML file that replays simulation frames on a canvas.\n\n    The output is viewable by opening the HTML file directly in a browser (no server).\n\n    Frame schema embedded into the HTML:\n      {step: int, width: int, height: int, agents: [[row, col, energy, age, direction], ...]}\n    \"\"\"\n\n    frames = []\n    for s in states:\n        agents = [\n            [pos.row, pos.col, agent.energy, agent.age, agent.direction]\n            for (pos, agent) in s.agents\n        ]\n        frames.append(\n            {\n                \"step\": int(s.step_number),\n                \"width\": int(s.width),\n                \"height\": int(s.height),\n                \"agents\": agents,\n            }\n        )\n\n    frames_json = json.dumps(frames, separators=(\",\", \":\"), ensure_ascii=False)\n\n    html = f\"\"\"<!DOCTYPE html>\n<html lang='en'>\n<head>\n  <meta charset='utf-8' />\n  <meta name='viewport' content='width=device-width, initial-scale=1' />\n  <title>worldsim</title>\n  <style>\n    body {{\n      margin: 0;\n      background: #1a1a2e;\n      color: #ffffff;\n      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: flex-start;\n      min-height: 100vh;\n    }}\n    canvas {{\n      margin-top: 16px;\n      border: 1px solid rgba(255,255,255,0.15);\n      background: #000000;\n      display: block;\n    }}\n    #info {{\n      margin: 10px 0 16px 0;\n      opacity: 0.9;\n    }}\n  </style>\n</head>\n<body>\n  <canvas id='grid' width='800' height='600'></canvas>\n  <p id='info'>step: 0</p>\n\n  <script>\n    const FRAMES = {frames_json};\n\n    const canvas = document.getElementById('grid');\n    const ctx = canvas.getContext('2d');\n    const info = document.getElementById('info');\n\n    let frameIndex = 0;\n    let paused = false;\n\n    function draw(i) {{\n      if (!FRAMES || FRAMES.length === 0) {{\n        ctx.fillStyle = '#000000';\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n        info.textContent = 'step: (no frames)';\n        return;\n      }}\n\n      const frame = FRAMES[i % FRAMES.length];\n      const cellW = canvas.width / frame.width;\n      const cellH = canvas.height / frame.height;\n\n      // background\n      ctx.fillStyle = '#000000';\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n      // agents\n      const agents = frame.agents;\n      for (let k = 0; k < agents.length; k++) {{\n        const a = agents[k];\n        const row = a[0];\n        const col = a[1];\n        const energy = a[2];\n\n        if (energy > 10) {{\n          ctx.fillStyle = '#00ff88';\n        }} else if (energy >= 5) {{\n          ctx.fillStyle = '#ffcc00';\n        }} else {{\n          ctx.fillStyle = '#ff4444';\n        }}\n\n        const x = col * cellW;\n        const y = row * cellH;\n        ctx.fillRect(x, y, Math.max(1, cellW - 1), Math.max(1, cellH - 1));\n      }}\n\n      info.textContent = 'step: ' + frame.step + '  frame: ' + (i % FRAMES.length) + '/' + (FRAMES.length - 1) + (paused ? '  (paused)' : '');\n    }}\n\n    function tick() {{\n      if (!paused) {{\n        draw(frameIndex);\n        frameIndex = (frameIndex + 1) % (FRAMES.length || 1);\n      }}\n    }}\n\n    canvas.addEventListener('click', () => {{\n      paused = !paused;\n      draw(frameIndex);\n    }});\n\n    // initial draw\n    draw(frameIndex);\n\n    // 200ms interval\n    setInterval(tick, 200);\n  </script>\n</body>\n</html>\n\"\"\"\n\n    out_path = Path(output_path)\n    out_path.parent.mkdir(parents=True, exist_ok=True)\n    out_path.write_text(html, encoding=\"utf-8\")\n",
      "path": "worldsim/render_html.py"
    }
  ]
}
