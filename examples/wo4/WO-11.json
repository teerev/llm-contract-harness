{
  "id": "WO-11",
  "title": "Add core simulation tests and enable pytest in verification",
  "intent": "Create tests/test_simulation.py with deterministic tests for rules correctness, world creation, stepping, population invariants, and collision safety, and update scripts/verify.sh to run pytest.",
  "allowed_files": [
    "tests/test_simulation.py",
    "scripts/verify.sh",
    "worldsim/types.py",
    "worldsim/rules.py",
    "worldsim/world.py"
  ],
  "forbidden": [
    "Do not modify worldsim/types.py",
    "Do not modify worldsim/rules.py",
    "Do not modify worldsim/world.py",
    "Do not modify any other worldsim/ files"
  ],
  "acceptance_commands": [
    "python -m pytest tests/test_simulation.py -q"
  ],
  "context_files": [
    "tests/test_simulation.py",
    "scripts/verify.sh",
    "worldsim/types.py",
    "worldsim/rules.py",
    "worldsim/world.py"
  ],
  "notes": "IMPORTANT: Read worldsim/rules.py, worldsim/world.py, and worldsim/types.py carefully to learn EXACT function signatures. Do NOT guess parameter names.\n\nCreate tests/test_simulation.py with at least these tests:\n1. create_world returns WorldState with correct dimensions, step_number=0, agents count > 0 for density > 0\n2. Determinism: create_world with same config twice produces identical WorldState\n3. step() increments step_number by 1\n4. Determinism: stepping same initial state twice produces identical StepResult\n5. Population invariant: for each of 10 steps, pop_before + births - deaths == pop_after\n6. No cell collisions: after every step, all agent positions are unique\n7. Multi-step determinism: run 20 steps from same seed, compare final states\n8. Energy bounds: all living agents in result have energy > 0\n9. Newborn counting: after each step, the number of agents with age == 0 must equal StepResult.births (because Phase 1 ages all pre-existing agents to age >= 1 before Phase 3 creates newborns at age 0)\n10. Rules pure function: calling default_ruleset does not mutate the input dict\n\nUpdate scripts/verify.sh to append 'python -m pytest -q' as the last line."
}
