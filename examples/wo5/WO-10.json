{
  "id": "WO-10",
  "title": "Implement HTML canvas viewer generator",
  "intent": "Create worldsim/render_html.py with a function that produces a standalone HTML file containing an animated canvas replay of simulation frames, viewable in any browser without a server.",
  "allowed_files": [
    "worldsim/render_html.py",
    "worldsim/types.py"
  ],
  "forbidden": [
    "Do not modify worldsim/types.py",
    "Do not modify any other existing files",
    "Do not import any external dependencies — stdlib only",
    "Do not use template engines"
  ],
  "acceptance_commands": [
    "python -c \"import tempfile, os; from worldsim.render_html import render_html; from worldsim.types import WorldState, Position, Agent; states = [WorldState(3,3,i,42,((Position(0,i%3), Agent(10-i,i,0)),)) for i in range(5)]; d = tempfile.mkdtemp(); p = os.path.join(d, 'sim.html'); render_html(states, p); content = open(p).read(); assert content.lstrip().lower().startswith('<!doctype'), 'not HTML'; assert '<canvas' in content.lower(), 'no canvas'\"",
    "python -c \"import tempfile, os; from worldsim.render_html import render_html; from worldsim.types import WorldState, Position, Agent; states = [WorldState(4,4,0,42,((Position(r,c), Agent(8,0,0)) for r in range(2) for c in range(2)))]; d = tempfile.mkdtemp(); p = os.path.join(d, 't.html'); render_html(states, p); assert os.path.getsize(p) > 500, 'HTML too small'\""
  ],
  "context_files": [
    "worldsim/render_html.py",
    "worldsim/types.py"
  ],
  "notes": "Define: render_html(states: list[WorldState], output_path: str) -> None.\n\nGenerate a self-contained HTML file that replays simulation frames on a canvas. Must work opened directly in a browser with no server.\n\nStructure:\n1. <!DOCTYPE html> with <title>worldsim</title>\n2. <style>: body background #1a1a2e, canvas centered, text white, font monospace.\n3. <script>: const FRAMES = [...]; — array of frame objects from states. Each frame: {step: int, width: int, height: int, agents: [[row, col, energy, age, direction], ...]}. Serialize using json.dumps.\n4. draw(frameIndex) function: cellW = canvas.width/frame.width, cellH = canvas.height/frame.height. Black background. Agents: green (#00ff88) if energy>10, yellow (#ffcc00) if 5-10, red (#ff4444) if <5. Filled rects at (col*cellW, row*cellH, cellW-1, cellH-1).\n5. setInterval at 200ms. Click canvas to toggle pause.\n6. <canvas id='grid' width='800' height='600'>, <p id='info'> for step counter.\n\nBuild as Python string with json.dumps for data. UTF-8 encoding. Do NOT modify worldsim/types.py."
}
