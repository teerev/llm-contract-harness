{
  "summary": "Added tests/test_render.py covering PNG creation, empty render output, byte-level determinism, and handling of negative coordinates for render_to_png().",
  "writes": [
    {
      "base_sha256": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
      "content": "import os\nimport tempfile\n\nfrom PIL import Image\n\nfrom lsysviz.render import render_to_png\nfrom lsysviz.types import Segment\n\n\nPNG_MAGIC = b\"\\x89PNG\\r\\n\\x1a\\n\"\n\n\ndef _read_bytes(path: str) -> bytes:\n    with open(path, \"rb\") as f:\n        return f.read()\n\n\ndef test_render_non_empty_creates_valid_png() -> None:\n    out_dir = tempfile.mkdtemp()\n    out_path = os.path.join(out_dir, \"non_empty.png\")\n\n    segments = [\n        Segment(0.0, 0.0, 10.0, 0.0),\n        Segment(10.0, 0.0, 10.0, 10.0),\n        Segment(10.0, 10.0, 0.0, 10.0),\n        Segment(0.0, 10.0, 0.0, 0.0),\n    ]\n\n    render_to_png(segments=segments, width=64, height=64, output_path=out_path)\n\n    assert os.path.exists(out_path)\n    data = _read_bytes(out_path)\n    assert data.startswith(PNG_MAGIC)\n\n    with Image.open(out_path) as img:\n        assert img.size == (64, 64)\n        assert img.format == \"PNG\"\n\n\ndef test_render_empty_segments_creates_file() -> None:\n    out_dir = tempfile.mkdtemp()\n    out_path = os.path.join(out_dir, \"empty.png\")\n\n    render_to_png(segments=[], width=32, height=24, output_path=out_path)\n\n    assert os.path.exists(out_path)\n    data = _read_bytes(out_path)\n    assert data.startswith(PNG_MAGIC)\n\n    with Image.open(out_path) as img:\n        assert img.size == (32, 24)\n        # Should be a blank white image; verify a few pixels.\n        px = img.convert(\"RGB\").load()\n        assert px[0, 0] == (255, 255, 255)\n        assert px[31, 23] == (255, 255, 255)\n\n\ndef test_render_determinism_byte_identical() -> None:\n    out_dir = tempfile.mkdtemp()\n    out_path1 = os.path.join(out_dir, \"det1.png\")\n    out_path2 = os.path.join(out_dir, \"det2.png\")\n\n    segments = [\n        Segment(0.0, 0.0, 100.0, 50.0),\n        Segment(100.0, 50.0, 25.0, 75.0),\n        Segment(25.0, 75.0, 0.0, 0.0),\n    ]\n\n    render_to_png(segments=segments, width=128, height=96, output_path=out_path1)\n    render_to_png(segments=segments, width=128, height=96, output_path=out_path2)\n\n    b1 = _read_bytes(out_path1)\n    b2 = _read_bytes(out_path2)\n    assert b1 == b2\n\n\ndef test_render_negative_coordinates_no_error() -> None:\n    out_dir = tempfile.mkdtemp()\n    out_path = os.path.join(out_dir, \"negative_coords.png\")\n\n    segments = [\n        Segment(-10.0, -10.0, -5.0, -20.0),\n        Segment(-5.0, -20.0, 15.0, 5.0),\n        Segment(15.0, 5.0, -10.0, -10.0),\n    ]\n\n    render_to_png(segments=segments, width=80, height=60, output_path=out_path)\n\n    assert os.path.exists(out_path)\n    data = _read_bytes(out_path)\n    assert data.startswith(PNG_MAGIC)\n\n    with Image.open(out_path) as img:\n        assert img.size == (80, 60)\n",
      "path": "tests/test_render.py"
    }
  ]
}
