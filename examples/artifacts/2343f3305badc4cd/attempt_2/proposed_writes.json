{
  "summary": "Added render_to_png tests covering PNG creation, empty render, byte-level determinism, and negative-coordinate handling; made Pillow usage optional to avoid import errors when PIL is not installed.",
  "writes": [
    {
      "base_sha256": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
      "content": "import os\nimport tempfile\n\nimport pytest\n\nfrom lsysviz.render import render_to_png\nfrom lsysviz.types import Segment\n\n\nPNG_MAGIC = b\"\\x89PNG\\r\\n\\x1a\\n\"\n\n\ndef _read_bytes(path: str) -> bytes:\n    with open(path, \"rb\") as f:\n        return f.read()\n\n\ndef test_render_non_empty_creates_valid_png() -> None:\n    out_dir = tempfile.mkdtemp()\n    out_path = os.path.join(out_dir, \"non_empty.png\")\n\n    segments = [Segment(0.0, 0.0, 10.0, 10.0), Segment(10.0, 0.0, 0.0, 10.0)]\n    render_to_png(segments=segments, width=64, height=64, output_path=out_path)\n\n    assert os.path.exists(out_path)\n    data = _read_bytes(out_path)\n    assert data.startswith(PNG_MAGIC)\n\n\ndef test_render_empty_creates_file_blank_white_image() -> None:\n    out_dir = tempfile.mkdtemp()\n    out_path = os.path.join(out_dir, \"empty.png\")\n\n    render_to_png(segments=[], width=32, height=16, output_path=out_path)\n\n    assert os.path.exists(out_path)\n    data = _read_bytes(out_path)\n    assert data.startswith(PNG_MAGIC)\n\n    # If Pillow is available, verify dimensions.\n    try:\n        from PIL import Image  # type: ignore\n\n        with Image.open(out_path) as im:\n            assert im.size == (32, 16)\n    except ModuleNotFoundError:\n        pass\n\n\ndef test_render_determinism_byte_identical_outputs() -> None:\n    out_dir = tempfile.mkdtemp()\n    out_path1 = os.path.join(out_dir, \"det1.png\")\n    out_path2 = os.path.join(out_dir, \"det2.png\")\n\n    segments = [\n        Segment(0.0, 0.0, 10.0, 0.0),\n        Segment(10.0, 0.0, 10.0, 10.0),\n        Segment(10.0, 10.0, 0.0, 10.0),\n        Segment(0.0, 10.0, 0.0, 0.0),\n    ]\n\n    render_to_png(segments=segments, width=80, height=60, output_path=out_path1)\n    render_to_png(segments=segments, width=80, height=60, output_path=out_path2)\n\n    b1 = _read_bytes(out_path1)\n    b2 = _read_bytes(out_path2)\n    assert b1 == b2\n\n\ndef test_render_negative_coordinates_no_error() -> None:\n    out_dir = tempfile.mkdtemp()\n    out_path = os.path.join(out_dir, \"negative_coords.png\")\n\n    segments = [\n        Segment(-10.0, -10.0, -5.0, -5.0),\n        Segment(-20.0, 5.0, 15.0, -25.0),\n    ]\n\n    # Should not raise; renderer must map arbitrary coordinate ranges.\n    render_to_png(segments=segments, width=64, height=64, output_path=out_path)\n\n    assert os.path.exists(out_path)\n    data = _read_bytes(out_path)\n    assert data.startswith(PNG_MAGIC)\n",
      "path": "tests/test_render.py"
    }
  ]
}
