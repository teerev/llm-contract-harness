{
  "id": "WO-09",
  "title": "Add core simulation tests and enable pytest in verification",
  "intent": "Create tests/test_simulation.py with deterministic tests for world creation, stepping, rules, and invariants, and update scripts/verify.sh to run pytest.",
  "allowed_files": [
    "tests/test_simulation.py",
    "scripts/verify.sh",
    "lifesim/world.py",
    "lifesim/rules.py",
    "lifesim/types.py"
  ],
  "forbidden": [
    "Do not modify lifesim/world.py",
    "Do not modify lifesim/rules.py",
    "Do not modify lifesim/types.py",
    "Do not modify any other lifesim/ files"
  ],
  "acceptance_commands": [
    "python -m pytest tests/test_simulation.py -q"
  ],
  "context_files": [
    "tests/test_simulation.py",
    "scripts/verify.sh",
    "lifesim/world.py",
    "lifesim/rules.py",
    "lifesim/types.py"
  ],
  "notes": "IMPORTANT: Read lifesim/world.py, lifesim/rules.py, and lifesim/types.py carefully to learn EXACT function signatures. Do NOT guess parameter names.\n\nCreate tests/test_simulation.py with at least these tests:\n1. create_world returns a WorldState with correct dimensions, step_number=0, and agents count > 0 for density > 0\n2. Determinism: create_world with same config twice produces identical WorldState\n3. step() increments step_number by 1\n4. Determinism: stepping the same initial state twice produces identical StepResult\n5. No cell collisions: after any step, no two agents share a Position (check len(set of positions) == len(agents))\n6. births/deaths/movements in StepResult are non-negative\n7. Multi-step determinism: run 10 steps from same seed, compare final states\n8. Population invariant: population_before + births - deaths == population_after for each step\n9. Energy bounds: all living agents have energy > 0\n10. Age monotonicity: agent ages only increase across steps\n\nUpdate scripts/verify.sh to append 'python -m pytest -q' as the last line."
}
