{
  "id": "WO-07",
  "title": "Implement checkpoint save and load",
  "intent": "Create lifesim/checkpoint.py with functions to save a WorldState to a JSON file and load it back, enabling simulation resumption.",
  "allowed_files": [
    "lifesim/checkpoint.py",
    "lifesim/types.py"
  ],
  "forbidden": [
    "Do not modify lifesim/types.py",
    "Do not modify any other existing files",
    "Do not import any external dependencies",
    "Do not use pickle â€” use JSON only"
  ],
  "acceptance_commands": [
    "python -c \"import tempfile, os; from lifesim.checkpoint import save_checkpoint, load_checkpoint; from lifesim.types import WorldState, Position, Agent; ws = WorldState(width=5, height=5, step_number=3, seed=42, agents=((Position(0,0), Agent(10,2,1)), (Position(3,4), Agent(5,7,3)))); d = tempfile.mkdtemp(); p = os.path.join(d, 'ck.json'); save_checkpoint(ws, p); ws2 = load_checkpoint(p); assert ws == ws2, f'round-trip failed: {ws} != {ws2}'\"",
    "python -c \"import tempfile, os; from lifesim.checkpoint import save_checkpoint, load_checkpoint; from lifesim.types import WorldState; ws = WorldState(3, 3, 0, 1, ()); d = tempfile.mkdtemp(); p = os.path.join(d, 'empty.json'); save_checkpoint(ws, p); ws2 = load_checkpoint(p); assert ws == ws2\""
  ],
  "context_files": [
    "lifesim/checkpoint.py",
    "lifesim/types.py"
  ],
  "notes": "Define two functions:\n\nsave_checkpoint(state: WorldState, path: str) -> None: serialize the WorldState to a JSON file. Convert the agents tuple of (Position, Agent) pairs into a JSON-serializable structure (e.g. list of dicts or list of lists). Write with sorted keys and 2-space indent for human readability.\n\nload_checkpoint(path: str) -> WorldState: read the JSON file and reconstruct a WorldState with all fields, including re-creating Position and Agent NamedTuples and the sorted agents tuple.\n\nThe round-trip must be lossless: load_checkpoint(save_checkpoint(ws)) == ws for any valid WorldState. Use only stdlib json module. Do NOT modify lifesim/types.py."
}
