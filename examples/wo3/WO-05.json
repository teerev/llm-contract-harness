{
  "id": "WO-05",
  "title": "Implement statistics collector",
  "intent": "Create lifesim/stats.py with a StatsCollector class that records per-tick metrics and can emit them as structured data.",
  "allowed_files": [
    "lifesim/stats.py",
    "lifesim/types.py"
  ],
  "forbidden": [
    "Do not modify lifesim/types.py",
    "Do not modify any other existing files",
    "Do not import any external dependencies"
  ],
  "acceptance_commands": [
    "python -c \"from lifesim.stats import StatsCollector; from lifesim.types import StepResult, WorldState, TickMetrics, Position, Agent; ws = WorldState(5, 5, 1, 42, ((Position(0,0), Agent(10, 1, 0)),)); sr = StepResult(world=ws, births=1, deaths=2, movements=3); sc = StatsCollector(); tm = sc.record(sr); assert tm.population == 1 and tm.births == 1 and tm.deaths == 2 and tm.avg_energy == 10.0\"",
    "python -c \"from lifesim.stats import StatsCollector; from lifesim.types import StepResult, WorldState; ws = WorldState(5, 5, 0, 42, ()); sr = StepResult(world=ws, births=0, deaths=0, movements=0); sc = StatsCollector(); sc.record(sr); h = sc.get_history(); assert len(h) == 1; csv = sc.to_csv(); assert 'step_number' in csv\""
  ],
  "context_files": [
    "lifesim/stats.py",
    "lifesim/types.py"
  ],
  "notes": "Define class StatsCollector with:\n- __init__(self): initialize empty history list\n- record(self, step_result: StepResult) -> TickMetrics: compute TickMetrics from the StepResult (population = len(world.agents), avg_energy = mean of all agent energies or 0.0 if no agents), append to history, return the TickMetrics\n- get_history(self) -> list[TickMetrics]: return copy of recorded metrics list\n- to_csv(self) -> str: return CSV string with header 'step_number,population,births,deaths,avg_energy' and one row per recorded tick, using comma separator and newline between rows\n\nThe class must be pure (no side effects beyond internal state). Do NOT modify lifesim/types.py."
}
