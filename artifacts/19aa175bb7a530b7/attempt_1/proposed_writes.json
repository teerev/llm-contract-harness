{
  "summary": "Updated CLI to accept full L-system parameters, expand grammar, interpret via turtle, and render to PNG while preserving existing --version behavior.",
  "writes": [
    {
      "base_sha256": "b31ebdbc32e5405a3d786ba29838d9d29490673b9b406b02e9e49f3600651bf0",
      "content": "from __future__ import annotations\n\nimport argparse\n\nfrom . import __version__\nfrom .expand import expand\nfrom .render import render_to_png\nfrom .turtle import interpret\nfrom .types import Grammar\n\n\ndef build_parser() -> argparse.ArgumentParser:\n    parser = argparse.ArgumentParser(prog=\"lsysviz\")\n    parser.add_argument(\n        \"--version\",\n        action=\"store_true\",\n        help=\"Print version information and exit.\",\n    )\n\n    parser.add_argument(\n        \"--axiom\",\n        type=str,\n        required=True,\n        help=\"Starting axiom string for the L-system.\",\n    )\n    parser.add_argument(\n        \"--rule\",\n        type=str,\n        action=\"append\",\n        required=True,\n        help=\"Rewrite rule in the form 'SYMBOL=REPLACEMENT' (repeatable).\",\n    )\n    parser.add_argument(\n        \"--iterations\",\n        type=int,\n        required=True,\n        help=\"Number of expansion iterations.\",\n    )\n    parser.add_argument(\n        \"--angle\",\n        type=float,\n        required=True,\n        help=\"Turn angle in degrees.\",\n    )\n    parser.add_argument(\n        \"--step\",\n        type=float,\n        required=True,\n        help=\"Step length for forward moves.\",\n    )\n    parser.add_argument(\n        \"--output\",\n        type=str,\n        required=True,\n        help=\"Output PNG path.\",\n    )\n\n    parser.add_argument(\n        \"--width\",\n        type=int,\n        default=800,\n        help=\"Output image width in pixels (default: 800).\",\n    )\n    parser.add_argument(\n        \"--height\",\n        type=int,\n        default=600,\n        help=\"Output image height in pixels (default: 600).\",\n    )\n\n    return parser\n\n\ndef _parse_rules(rule_args: list[str]) -> dict[str, str]:\n    rules: dict[str, str] = {}\n    for raw in rule_args:\n        if \"=\" not in raw:\n            raise ValueError(f\"Invalid --rule '{raw}': expected format SYMBOL=REPLACEMENT\")\n        symbol, replacement = raw.split(\"=\", 1)\n        if symbol == \"\":\n            raise ValueError(f\"Invalid --rule '{raw}': SYMBOL must be non-empty\")\n        rules[symbol] = replacement\n    return rules\n\n\ndef main(argv: list[str] | None = None) -> int:\n    parser = build_parser()\n    args = parser.parse_args(argv)\n\n    if args.version:\n        print(__version__)\n        return 0\n\n    rules = _parse_rules(args.rule)\n    grammar = Grammar(axiom=args.axiom, rules=rules)\n\n    lstring = expand(grammar, iterations=args.iterations)\n    segments = interpret(lstring, angle_deg=args.angle, step_length=args.step)\n    render_to_png(segments, width=args.width, height=args.height, output_path=args.output)\n\n    return 0\n",
      "path": "lsysviz/cli.py"
    }
  ]
}
